<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elora.AI - Advanced AI Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'elora': {
                            'primary': '#06b6d4',
                            'secondary': '#0891b2',
                            'dark': '#0f172a',
                            'slate': '#1e293b'
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-in-out',
                        'slide-in': 'slideIn 0.3s ease-out',
                        'bounce-gentle': 'bounceGentle 2s infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        },
                        slideIn: {
                            '0%': { transform: 'translateX(-100%)' },
                            '100%': { transform: 'translateX(0)' }
                        },
                        bounceGentle: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' }
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .sidebar-transition {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .message-bubble {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        .typing-indicator span {
            animation: bounceGentle 1.4s infinite ease-in-out;
        }
        
        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(30, 41, 59, 0.8);
        }
        
        .file-drop-zone {
            border: 2px dashed #64748b;
            transition: all 0.3s ease;
        }
        
        .file-drop-zone.drag-over {
            border-color: #06b6d4;
            background-color: rgba(6, 182, 212, 0.1);
        }
    </style>
</head>
<body class="font-inter bg-slate-900 text-gray-100 overflow-hidden">
    <!-- Authentication Modal -->
    <div id="auth-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-slate-800 rounded-2xl p-8 max-w-md w-full mx-4 shadow-2xl">
            <div class="text-center mb-6">
                <!-- Elora.AI Logo with glowing effect -->
                <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-2xl mb-4 relative">
                    <div class="absolute inset-0 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-2xl blur-lg opacity-30"></div>
                    <svg class="w-8 h-8 text-white relative z-10" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                    </svg>
                </div>
                <h2 class="text-2xl font-bold text-white mb-2">Welcome to Elora.AI</h2>
                <p class="text-gray-400">Sign in to access your AI assistant</p>
            </div>
            
            <!-- Login Form -->
            <div id="login-form" class="space-y-4">
                <div>
                    <input type="email" placeholder="Email address" class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-cyan-500">
                </div>
                <div>
                    <input type="password" placeholder="Password" class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-cyan-500">
                </div>
                <button class="w-full bg-gradient-to-r from-cyan-500 to-blue-600 text-white py-3 rounded-lg font-medium hover:from-cyan-600 hover:to-blue-700 transition-all duration-200 transform hover:scale-105">
                    Sign In
                </button>
                <div class="text-center">
                    <span class="text-gray-400">or</span>
                </div>
                <button class="w-full bg-white text-gray-800 py-3 rounded-lg font-medium hover:bg-gray-100 transition-colors duration-200 flex items-center justify-center space-x-2">
                    <i class="fab fa-google text-red-500"></i>
                    <span>Continue with Google</span>
                </button>
                <div class="text-center">
                    <button id="show-signup" class="text-cyan-400 hover:text-cyan-300 text-sm">Don't have an account? Sign up</button>
                </div>
            </div>
            
            <!-- Signup Form -->
            <div id="signup-form" class="space-y-4 hidden">
                <div>
                    <input type="text" placeholder="Full name" class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-cyan-500">
                </div>
                <div>
                    <input type="email" placeholder="Email address" class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-cyan-500">
                </div>
                <div>
                    <input type="password" placeholder="Password" class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-cyan-500">
                </div>
                <button class="w-full bg-gradient-to-r from-cyan-500 to-blue-600 text-white py-3 rounded-lg font-medium hover:from-cyan-600 hover:to-blue-700 transition-all duration-200 transform hover:scale-105">
                    Create Account
                </button>
                <div class="text-center">
                    <span class="text-gray-400">or</span>
                </div>
                <button class="w-full bg-white text-gray-800 py-3 rounded-lg font-medium hover:bg-gray-100 transition-colors duration-200 flex items-center justify-center space-x-2">
                    <i class="fab fa-google text-red-500"></i>
                    <span>Sign up with Google</span>
                </button>
                <div class="text-center">
                    <button id="show-login" class="text-cyan-400 hover:text-cyan-300 text-sm">Already have an account? Sign in</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App Container -->
    <div class="flex h-screen">
        <!-- Collapsible Sidebar -->
        <div id="sidebar" class="sidebar-transition bg-slate-800 border-r border-slate-700 flex flex-col" style="width: 280px;">
            <!-- Sidebar Header -->
            <div class="flex items-center justify-between p-4 border-b border-slate-700">
                <div class="flex items-center space-x-3">
                    <!-- Elora.AI Logo -->
                    <div class="w-8 h-8 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-lg flex items-center justify-center">
                        <svg class="w-4 h-4 text-white" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                        </svg>
                    </div>
                    <span class="font-bold text-white text-lg sidebar-text">Elora.AI</span>
                </div>
                <button id="sidebar-toggle" class="p-2 hover:bg-slate-700 rounded-lg transition-colors duration-200">
                    <i class="fas fa-bars text-gray-400"></i>
                </button>
            </div>
            
            <!-- New Chat Button -->
            <div class="p-4">
                <button id="new-chat-btn" class="w-full bg-gradient-to-r from-cyan-500 to-blue-600 text-white py-3 rounded-lg font-medium hover:from-cyan-600 hover:to-blue-700 transition-all duration-200 transform hover:scale-105 flex items-center justify-center space-x-2">
                    <i class="fas fa-plus"></i>
                    <span class="sidebar-text">New Chat</span>
                </button>
            </div>
            
            <!-- Chat History -->
            <div class="flex-1 overflow-y-auto p-4">
                <h3 class="text-sm font-medium text-gray-400 mb-3 sidebar-text">Recent Chats</h3>
                <div class="space-y-2" id="chat-history">
                    <!-- Chat history items will be populated here -->
                    <div class="chat-history-item p-3 hover:bg-slate-700 rounded-lg cursor-pointer transition-colors duration-200">
                        <div class="font-medium text-white text-sm sidebar-text">Getting Started with AI</div>
                        <div class="text-gray-400 text-xs mt-1 sidebar-text">2 hours ago</div>
                    </div>
                    <div class="chat-history-item p-3 hover:bg-slate-700 rounded-lg cursor-pointer transition-colors duration-200">
                        <div class="font-medium text-white text-sm sidebar-text">Image Analysis Project</div>
                        <div class="text-gray-400 text-xs mt-1 sidebar-text">Yesterday</div>
                    </div>
                    <div class="chat-history-item p-3 hover:bg-slate-700 rounded-lg cursor-pointer transition-colors duration-200">
                        <div class="font-medium text-white text-sm sidebar-text">Code Review Session</div>
                        <div class="text-gray-400 text-xs mt-1 sidebar-text">3 days ago</div>
                    </div>
                </div>
            </div>
            
            <!-- Library Section -->
            <div class="p-4 border-t border-slate-700">
                <h3 class="text-sm font-medium text-gray-400 mb-3 sidebar-text">Library</h3>
                <div class="space-y-2">
                    <button class="w-full flex items-center space-x-3 p-2 hover:bg-slate-700 rounded-lg transition-colors duration-200 text-left">
                        <i class="fas fa-video text-purple-400"></i>
                        <span class="text-white text-sm sidebar-text">Video Generator</span>
                    </button>
                    <button class="w-full flex items-center space-x-3 p-2 hover:bg-slate-700 rounded-lg transition-colors duration-200 text-left">
                        <i class="fas fa-image text-green-400"></i>
                        <span class="text-white text-sm sidebar-text">Image Editor</span>
                    </button>
                    <button class="w-full flex items-center space-x-3 p-2 hover:bg-slate-700 rounded-lg transition-colors duration-200 text-left">
                        <i class="fas fa-chart-bar text-blue-400"></i>
                        <span class="text-white text-sm sidebar-text">Analytics</span>
                    </button>
                </div>
            </div>
            
            <!-- User Profile -->
            <div class="p-4 border-t border-slate-700">
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-gradient-to-br from-purple-400 to-pink-400 rounded-full flex items-center justify-center">
                        <span class="text-white text-sm font-medium">U</span>
                    </div>
                    <div class="flex-1 sidebar-text">
                        <div class="text-white text-sm font-medium">User Account</div>
                        <div class="text-gray-400 text-xs">user@example.com</div>
                    </div>
                    <button class="p-2 hover:bg-slate-700 rounded-lg transition-colors duration-200">
                        <i class="fas fa-cog text-gray-400"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Main Content Area -->
        <div class="flex-1 flex flex-col">
            <!-- Top Header -->
            <header class="bg-slate-800 border-b border-slate-700 px-6 py-4 flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button id="mobile-sidebar-toggle" class="md:hidden p-2 hover:bg-slate-700 rounded-lg transition-colors duration-200">
                        <i class="fas fa-bars text-gray-400"></i>
                    </button>
                    <h1 class="text-xl font-bold text-white">AI Assistant</h1>
                </div>
                
                <div class="flex items-center space-x-4">
                    <!-- Theme Toggle -->
                    <button id="theme-toggle" class="p-2 hover:bg-slate-700 rounded-lg transition-colors duration-200">
                        <i class="fas fa-moon text-gray-400"></i>
                    </button>
                    
                    <!-- Notifications -->
                    <button class="p-2 hover:bg-slate-700 rounded-lg transition-colors duration-200 relative">
                        <i class="fas fa-bell text-gray-400"></i>
                        <span class="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full"></span>
                    </button>
                    
                    <!-- User Menu -->
                    <button class="flex items-center space-x-2 p-2 hover:bg-slate-700 rounded-lg transition-colors duration-200">
                        <div class="w-8 h-8 bg-gradient-to-br from-purple-400 to-pink-400 rounded-full flex items-center justify-center">
                            <span class="text-white text-sm font-medium">U</span>
                        </div>
                    </button>
                </div>
            </header>
            
            <!-- Chat Messages Area -->
            <div class="flex-1 overflow-y-auto p-6 space-y-6" id="chat-messages">
                <!-- Welcome Message -->
                <div class="text-center py-12">
                    <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-2xl mb-4 relative">
                        <div class="absolute inset-0 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-2xl blur-lg opacity-30"></div>
                        <svg class="w-8 h-8 text-white relative z-10" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                        </svg>
                    </div>
                    <h2 class="text-2xl font-bold text-white mb-2">Welcome to Elora.AI</h2>
                    <p class="text-gray-400 max-w-md mx-auto">Your advanced AI assistant is ready to help with text, images, videos, code analysis, and more. What would you like to explore today?</p>
                </div>
                
                <!-- Sample Conversation -->
                <div class="message-bubble">
                    <div class="flex items-start space-x-3 mb-4">
                        <div class="w-8 h-8 bg-gradient-to-br from-purple-400 to-pink-400 rounded-full flex items-center justify-center flex-shrink-0">
                            <span class="text-white text-sm font-medium">U</span>
                        </div>
                        <div class="bg-slate-700 rounded-2xl rounded-tl-md px-4 py-3 max-w-3xl">
                            <p class="text-white">Can you help me analyze this data and create a visualization?</p>
                        </div>
                    </div>
                </div>
                
                <div class="message-bubble">
                    <div class="flex items-start space-x-3 mb-4">
                        <div class="w-8 h-8 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-full flex items-center justify-center flex-shrink-0">
                            <svg class="w-4 h-4 text-white" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                            </svg>
                        </div>
                        <div class="bg-slate-800 rounded-2xl rounded-tl-md px-4 py-3 max-w-3xl">
                            <p class="text-white mb-3">I'd be happy to help you analyze data and create visualizations! I can work with various data formats and generate interactive charts and graphs.</p>
                            
                            <!-- Sample Chart -->
                            <div class="bg-white rounded-lg p-4 mb-3">
                                <div class="h-48 flex items-end justify-center space-x-2">
                                    <div class="w-8 bg-cyan-400 rounded-t" style="height: 60%"></div>
                                    <div class="w-8 bg-blue-500 rounded-t" style="height: 80%"></div>
                                    <div class="w-8 bg-purple-500 rounded-t" style="height: 45%"></div>
                                    <div class="w-8 bg-pink-500 rounded-t" style="height: 90%"></div>
                                    <div class="w-8 bg-green-500 rounded-t" style="height: 70%"></div>
                                </div>
                                <div class="text-gray-600 text-sm text-center mt-2">Sample Data Visualization</div>
                            </div>
                            
                            <p class="text-gray-300 text-sm">Please upload your data file (CSV, Excel, JSON, etc.) or share the data you'd like me to analyze.</p>
                            
                            <!-- Speaker Button -->
                            <button class="mt-2 p-2 hover:bg-slate-700 rounded-lg transition-colors duration-200">
                                <i class="fas fa-volume-up text-gray-400 hover:text-cyan-400"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Typing Indicator -->
                <div class="typing-indicator hidden">
                    <div class="flex items-start space-x-3">
                        <div class="w-8 h-8 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-full flex items-center justify-center flex-shrink-0">
                            <svg class="w-4 h-4 text-white" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                            </svg>
                        </div>
                        <div class="bg-slate-800 rounded-2xl rounded-tl-md px-4 py-3">
                            <div class="flex space-x-1">
                                <span class="w-2 h-2 bg-gray-400 rounded-full"></span>
                                <span class="w-2 h-2 bg-gray-400 rounded-full"></span>
                                <span class="w-2 h-2 bg-gray-400 rounded-full"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Input Area -->
            <div class="border-t border-slate-700 bg-slate-800 p-6">
                <!-- File Drop Zone -->
                <div class="file-drop-zone rounded-lg p-4 mb-4 text-center hidden" id="file-drop-zone">
                    <i class="fas fa-cloud-upload-alt text-3xl text-gray-400 mb-2"></i>
                    <p class="text-gray-400">Drop files here or click to browse</p>
                    <p class="text-gray-500 text-sm">Supports images, videos, documents, code files, and more</p>
                </div>
                
                <!-- Input Container -->
                <div class="flex items-end space-x-3">
                    <!-- File Upload Button -->
                    <button id="file-upload-btn" class="p-3 bg-slate-700 hover:bg-slate-600 rounded-xl transition-colors duration-200">
                        <i class="fas fa-paperclip text-gray-400"></i>
                    </button>
                    
                    <!-- Voice Input Button -->
                    <button id="voice-input-btn" class="p-3 bg-slate-700 hover:bg-slate-600 rounded-xl transition-colors duration-200">
                        <i class="fas fa-microphone text-gray-400"></i>
                    </button>
                    
                    <!-- Text Input -->
                    <div class="flex-1 relative">
                        <textarea 
                            id="message-input" 
                            placeholder="Ask me anything... I can help with text, images, videos, code, and more!"
                            class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white placeholder-gray-400 resize-none focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent max-h-32"
                            rows="1"
                        ></textarea>
                        
                        <!-- Quick Actions -->
                        <div class="absolute right-2 bottom-2 flex space-x-1">
                            <button class="p-1 hover:bg-slate-600 rounded text-gray-400 text-xs">
                                <i class="fas fa-image"></i>
                            </button>
                            <button class="p-1 hover:bg-slate-600 rounded text-gray-400 text-xs">
                                <i class="fas fa-code"></i>
                            </button>
                            <button class="p-1 hover:bg-slate-600 rounded text-gray-400 text-xs">
                                <i class="fas fa-chart-bar"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Send Button -->
                    <button id="send-btn" class="p-3 bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 rounded-xl transition-all duration-200 transform hover:scale-105">
                        <i class="fas fa-paper-plane text-white"></i>
                    </button>
                </div>
                
                <!-- Input Info -->
                <div class="flex items-center justify-between mt-3 text-xs text-gray-500">
                    <div class="flex items-center space-x-4">
                        <span>Powered by advanced AI models</span>
                        <span>•</span>
                        <span>Supports 100+ file formats</span>
                    </div>
                    <div>
                        <span id="char-count">0</span> / 4000
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Hidden File Input -->
    <input type="file" id="file-input" class="hidden" multiple accept="*/*">

    <script type="module">
        // Firebase imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signInWithPopup, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, serverTimestamp, getDocs, deleteDoc, writeBatch } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            // TODO: Add your Firebase config
            apiKey: "your-api-key",
            authDomain: "your-project.firebaseapp.com",
            projectId: "your-project-id",
            storageBucket: "your-project.appspot.com",
            messagingSenderId: "123456789",
            appId: "your-app-id"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        // DOM elements
        const authModal = document.getElementById('auth-modal');
        const loginForm = document.getElementById('login-form');
        const signupForm = document.getElementById('signup-form');
        const showSignupBtn = document.getElementById('show-signup');
        const showLoginBtn = document.getElementById('show-login');
        const sidebar = document.getElementById('sidebar');
        const sidebarToggle = document.getElementById('sidebar-toggle');
        const mobileSidebarToggle = document.getElementById('mobile-sidebar-toggle');
        const newChatBtn = document.getElementById('new-chat-btn');
        const themeToggle = document.getElementById('theme-toggle');
        const messageInput = document.getElementById('message-input');
        const sendBtn = document.getElementById('send-btn');
        const chatMessages = document.getElementById('chat-messages');
        const fileUploadBtn = document.getElementById('file-upload-btn');
        const voiceInputBtn = document.getElementById('voice-input-btn');
        const fileInput = document.getElementById('file-input');
        const fileDropZone = document.getElementById('file-drop-zone');
        const charCount = document.getElementById('char-count');

        // State management
        let isAuthenticated = false;
        let isSidebarCollapsed = false;
        let isRecording = false;
        let mediaRecorder = null;
        let recognition = null;

        // Initialize app
        (function initializeApp() {
            // Show auth modal initially
            authModal.classList.remove('hidden');
            
            // Set up auth state listener
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    isAuthenticated = true;
                    authModal.classList.add('hidden');
                    loadChatHistory();
                } else {
                    isAuthenticated = false;
                    authModal.classList.remove('hidden');
                }
            });

            // Set up event listeners
            setupEventListeners();
            setupSpeechRecognition();
            autoResizeTextarea();
        })();

        function setupEventListeners() {
            // Auth form toggles
            showSignupBtn.addEventListener('click', () => {
                loginForm.classList.add('hidden');
                signupForm.classList.remove('hidden');
            });

            showLoginBtn.addEventListener('click', () => {
                signupForm.classList.add('hidden');
                loginForm.classList.remove('hidden');
            });

            // Sidebar toggle
            sidebarToggle.addEventListener('click', toggleSidebar);
            mobileSidebarToggle.addEventListener('click', toggleSidebar);

            // Theme toggle
            themeToggle.addEventListener('click', toggleTheme);

            // Chat functionality
            sendBtn.addEventListener('click', sendMessage);
            messageInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            // File handling
            fileUploadBtn.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', handleFileSelect);
            
            // Voice input
            voiceInputBtn.addEventListener('click', toggleVoiceInput);

            // Character count
            messageInput.addEventListener('input', updateCharCount);

            // File drop zone
            document.addEventListener('dragover', (e) => {
                e.preventDefault();
                fileDropZone.classList.remove('hidden');
                fileDropZone.classList.add('drag-over');
            });

            document.addEventListener('dragleave', (e) => {
                if (!e.relatedTarget) {
                    fileDropZone.classList.add('hidden');
                    fileDropZone.classList.remove('drag-over');
                }
            });

            document.addEventListener('drop', (e) => {
                e.preventDefault();
                fileDropZone.classList.add('hidden');
                fileDropZone.classList.remove('drag-over');
                handleFileSelect({ target: { files: e.dataTransfer.files } });
            });

            // New chat
            newChatBtn.addEventListener('click', startNewChat);
        }

        function toggleSidebar() {
            isSidebarCollapsed = !isSidebarCollapsed;
            
            if (isSidebarCollapsed) {
                sidebar.style.width = '60px';
                sidebar.querySelectorAll('.sidebar-text').forEach(el => {
                    el.style.display = 'none';
                });
            } else {
                sidebar.style.width = '280px';
                setTimeout(() => {
                    sidebar.querySelectorAll('.sidebar-text').forEach(el => {
                        el.style.display = 'block';
                    });
                }, 200);
            }
        }

        function toggleTheme() {
            // TODO: Implement theme switching between dark and light modes
            document.body.classList.toggle('light-theme');
            const icon = themeToggle.querySelector('i');
            icon.classList.toggle('fa-moon');
            icon.classList.toggle('fa-sun');
        }

        function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;

            // Add user message
            addMessage('user', message);

            // Clear input
            messageInput.value = '';
            updateCharCount();

            // Show typing indicator
            showTypingIndicator();

            // TODO: Process message with AI APIs (OpenRouter/Gemini)
            setTimeout(() => {
                hideTypingIndicator();
                addMessage('ai', generateAIResponse(message));
            }, 2000);
        }

        function addMessage(sender, content, metadata = {}) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message-bubble';

            const isUser = sender === 'user';
            const avatar = isUser 
                ? '<div class="w-8 h-8 bg-gradient-to-br from-purple-400 to-pink-400 rounded-full flex items-center justify-center flex-shrink-0"><span class="text-white text-sm font-medium">U</span></div>'
                : '<div class="w-8 h-8 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-full flex items-center justify-center flex-shrink-0"><svg class="w-4 h-4 text-white" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg></div>';

            messageDiv.innerHTML = `
                <div class="flex items-start space-x-3 mb-4">
                    ${avatar}
                    <div class="bg-${isUser ? 'slate-700' : 'slate-800'} rounded-2xl rounded-tl-md px-4 py-3 max-w-3xl">
                        <div class="text-white">${formatMessage(content)}</div>
                        ${!isUser ? '<button class="mt-2 p-2 hover:bg-slate-700 rounded-lg transition-colors duration-200"><i class="fas fa-volume-up text-gray-400 hover:text-cyan-400"></i></button>' : ''}
                    </div>
                </div>
            `;

            // Remove welcome message if it exists
            const welcomeMsg = chatMessages.querySelector('.text-center');
            if (welcomeMsg) {
                welcomeMsg.remove();
            }

            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            // TODO: Save message to Firestore
            saveMessageToFirestore(sender, content, metadata);
        }

        function formatMessage(content) {
            // TODO: Implement proper message formatting for different content types
            // Handle code blocks, links, lists, etc.
            return content.replace(/\n/g, '<br>');
        }

        function generateAIResponse(message) {
            // TODO: Replace with actual AI API calls
            const responses = [
                "I understand you're asking about " + message.toLowerCase() + ". Let me help you with that.",
                "That's an interesting question! Here's what I can tell you about " + message.toLowerCase() + "...",
                "I'd be happy to assist with that. Based on your query about " + message.toLowerCase() + ", here are some insights:",
                "Great question! Let me analyze this for you and provide a comprehensive response."
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function showTypingIndicator() {
            document.querySelector('.typing-indicator').classList.remove('hidden');
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function hideTypingIndicator() {
            document.querySelector('.typing-indicator').classList.add('hidden');
        }

        function handleFileSelect(e) {
            const files = Array.from(e.target.files);
            if (files.length === 0) return;

            files.forEach(file => {
                // TODO: Process different file types
                console.log('Processing file:', file.name, file.type, file.size);
                
                // Add file message
                addMessage('user', `📎 Uploaded: ${file.name} (${formatFileSize(file.size)})`);
                
                // TODO: Send file for AI processing
                setTimeout(() => {
                    addMessage('ai', `I've received your file "${file.name}". Let me analyze it for you...`);
                }, 1000);
            });

            // Clear file input
            fileInput.value = '';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function setupSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = true;
                recognition.lang = 'en-US';

                recognition.onresult = (event) => {
                    const result = event.results[event.results.length - 1];
                    if (result.isFinal) {
                        messageInput.value = result[0].transcript;
                        updateCharCount();
                    }
                };

                recognition.onerror = (event) => {
                    console.error('Speech recognition error:', event.error);
                    isRecording = false;
                    voiceInputBtn.classList.remove('text-red-400');
                };

                recognition.onend = () => {
                    isRecording = false;
                    voiceInputBtn.classList.remove('text-red-400');
                };
            }
        }

        function toggleVoiceInput() {
            if (!recognition) {
                alert('Speech recognition is not supported in this browser.');
                return;
            }

            if (isRecording) {
                recognition.stop();
                isRecording = false;
                voiceInputBtn.classList.remove('text-red-400');
            } else {
                recognition.start();
                isRecording = true;
                voiceInputBtn.classList.add('text-red-400');
            }
        }

        function updateCharCount() {
            charCount.textContent = messageInput.value.length;
        }

        function autoResizeTextarea() {
            messageInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 128) + 'px';
            });
        }

        function startNewChat() {
            // Clear current chat
            chatMessages.innerHTML = `
                <div class="text-center py-12">
                    <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-2xl mb-4 relative">
                        <div class="absolute inset-0 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-2xl blur-lg opacity-30"></div>
                        <svg class="w-8 h-8 text-white relative z-10" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                        </svg>
                    </div>
                    <h2 class="text-2xl font-bold text-white mb-2">New Conversation</h2>
                    <p class="text-gray-400 max-w-md mx-auto">Start a fresh conversation with your AI assistant.</p>
                </div>
            `;
            
            // TODO: Create new chat session in Firestore
        }

        function loadChatHistory() {
            // TODO: Load chat history from Firestore
            console.log('Loading chat history...');
        }

        function saveMessageToFirestore(sender, content, metadata) {
            // TODO: Save message to Firestore database
            console.log('Saving message:', { sender, content, metadata });
        }

        // TODO: Implement API calls to OpenRouter and Gemini
        async function callOpenRouter(message, options = {}) {
            // Implementation for OpenRouter API
        }

        async function callGemini(message, options = {}) {
            // Implementation for Gemini API
        }

        // TODO: Implement text-to-speech functionality
        function speakText(text) {
            // Implementation for text-to-speech
        }

        // TODO: Implement advanced file processing
        function processFile(file) {
            // Implementation for file analysis and processing
        }
    </script>
</body>
</html>